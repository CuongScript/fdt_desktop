<div class="rules-container">
  <!-- Add New Rule Card -->
  <div class="card mb-4">
    <div class="card-header">
      <h5 class="card-title mb-0">Thêm Quy Tắc Mới</h5>
    </div>
    <div class="card-body">
      <form [formGroup]="ruleForm" (ngSubmit)="addRule()">
        <div class="row g-3 mb-3">
          <div class="col-md-4">
            <label for="source" class="form-label">Thư mục nguồn</label>
            <div class="input-group">
              <input
                type="text"
                class="form-control"
                id="source"
                formControlName="source"
                placeholder="Đường dẫn thư mục nguồn"
                [ngClass]="{
                  'is-invalid':
                    ruleForm.get('source')?.invalid &&
                    ruleForm.get('source')?.touched
                }"
              />
              <button
                type="button"
                class="btn btn-outline-secondary"
                (click)="selectSourceDirectory()"
                title="Chọn thư mục nguồn"
              >
                <i class="bi bi-folder2-open"></i>
              </button>
              <div
                class="invalid-feedback"
                *ngIf="
                  ruleForm.get('source')?.invalid &&
                  ruleForm.get('source')?.touched
                "
              >
                Vui lòng nhập đường dẫn thư mục nguồn
              </div>
            </div>
          </div>

          <div class="col-md-4">
            <label for="destination" class="form-label">Thư mục đích</label>
            <div class="input-group">
              <input
                type="text"
                class="form-control"
                id="destination"
                formControlName="destination"
                placeholder="Đường dẫn thư mục đích"
                [ngClass]="{
                  'is-invalid':
                    ruleForm.get('destination')?.invalid &&
                    ruleForm.get('destination')?.touched
                }"
              />
              <button
                type="button"
                class="btn btn-outline-secondary"
                (click)="selectDestinationDirectory()"
                title="Chọn thư mục đích"
              >
                <i class="bi bi-folder2-open"></i>
              </button>
              <div
                class="invalid-feedback"
                *ngIf="
                  ruleForm.get('destination')?.invalid &&
                  ruleForm.get('destination')?.touched
                "
              >
                Vui lòng nhập đường dẫn thư mục đích
              </div>
            </div>
          </div>

          <div class="col-md-4">
            <label for="pattern" class="form-label">Biểu thức regex</label>
            <input
              type="text"
              class="form-control"
              id="pattern"
              formControlName="pattern"
              placeholder="Regex cho tên file"
              [ngClass]="{
                'is-invalid':
                  ruleForm.get('pattern')?.invalid &&
                  ruleForm.get('pattern')?.touched
              }"
            />
            <div
              class="invalid-feedback"
              *ngIf="
                ruleForm.get('pattern')?.invalid &&
                ruleForm.get('pattern')?.touched
              "
            >
              Vui lòng nhập biểu thức regex
            </div>
            <div class="form-check mt-2">
              <input
                class="form-check-input"
                type="checkbox"
                id="createSubfolders"
                formControlName="createSubfolders"
              />
              <label class="form-check-label" for="createSubfolders">
                Tạo thư mục con dựa trên kết quả regex
              </label>
              <small class="form-text text-muted d-block">
                Nếu bật, ứng dụng sẽ tạo thư mục con trong thư mục đích dựa trên
                kết quả bắt được từ regex
              </small>
            </div>

            <!-- Operation radio buttons -->
            <div class="mt-3">
              <label class="form-label d-block">Chọn kiểu thao tác:</label>
              <div class="form-check form-check-inline">
                <input
                  class="form-check-input"
                  type="radio"
                  id="operationCopy"
                  formControlName="operation"
                  value="copy"
                />
                <label class="form-check-label" for="operationCopy"
                  >Sao chép file</label
                >
              </div>
              <div class="form-check form-check-inline">
                <input
                  class="form-check-input"
                  type="radio"
                  id="operationMove"
                  formControlName="operation"
                  value="move"
                />
                <label class="form-check-label" for="operationMove"
                  >Di chuyển file</label
                >
              </div>
            </div>
            <small class="form-text text-muted mt-2">
              Ví dụ:<br />
              .*\.pdf để tìm file PDF<br />
              .*\.jpe?g để tìm file JPEG/JPG<br />
              .*\.png để tìm file PNG<br />
              .*\.docx? để tìm file DOC/DOCX<br />
              .*\.xlsx? để tìm file XLS/XLSX<br />
              .*_backup_.* để tìm file có chứa '_backup_'<br />
              ^IMG_\d{{ "{" }}4{{ "}" }}\.jpg$ để tìm ảnh theo định dạng
              IMG_XXXX.jpg<br />
              ^data\d{{ "{" }}2{{ "}" }}_.+\.csv$ để tìm file CSV bắt đầu bằng
              'data' và 2 số<br />
              .+\.(zip|rar|7z)$ để tìm file nén<br />
              ^((?!temp).)*$ để tìm file không chứa 'temp'<br />
              ^\d{{ "{" }}4{{ "}" }}-\d{{ "{" }}2{{ "}" }}-\d{{ "{" }}2{{
                "}"
              }}_.+$ để tìm file bắt đầu bằng định dạng ngày tháng
            </small>
          </div>
        </div>

        <button
          class="btn btn-primary"
          type="submit"
          [disabled]="!ruleForm.valid"
        >
          <i class="bi bi-plus-lg"></i> Thêm Quy Tắc
        </button>
      </form>
    </div>
  </div>

  <!-- Rules List Card -->
  <div class="card">
    <div class="card-header">
      <h5 class="card-title mb-0">Danh Sách Quy Tắc</h5>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th scope="col">STT</th>
              <th scope="col">Nguồn</th>
              <th scope="col">Đích</th>
              <th scope="col">Regex</th>
              <th scope="col">Thư mục con</th>
              <th scope="col">Thao tác</th>
              <th scope="col">Hành động</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let rule of rules; let i = index">
              <td>{{ i }}</td>
              <td>{{ rule.source }}</td>
              <td>{{ rule.destination }}</td>
              <td>{{ rule.pattern }}</td>
              <td>
                <i
                  class="bi"
                  [ngClass]="
                    rule.createSubfolders
                      ? 'bi-check-circle text-success'
                      : 'bi-x-circle text-secondary'
                  "
                ></i>
              </td>
              <td>
                <span
                  [ngClass]="
                    rule.operation === 'move' ? 'text-warning' : 'text-info'
                  "
                >
                  <i
                    class="bi"
                    [ngClass]="
                      rule.operation === 'move' ? 'bi-scissors' : 'bi-files'
                    "
                  ></i>
                  {{ rule.operation === "move" ? "Di chuyển" : "Sao chép" }}
                </span>
              </td>
              <td>
                <button
                  class="btn btn-sm btn-danger"
                  (click)="deleteRule(i)"
                  title="Xóa quy tắc"
                >
                  <i class="bi bi-trash"></i>
                </button>
              </td>
            </tr>
            <tr *ngIf="rules.length === 0">
              <td colspan="7" class="text-center">Không có quy tắc nào</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
